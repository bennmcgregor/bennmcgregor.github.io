{"version":3,"sources":["webpack:///./src/components/erging-classifier/seek-display.js","webpack:///./src/pages/hidden/erging-classifier-upload.js"],"names":["SeekDisplay","CAPTURE_OPTIONS","video","RECORDING_OPTIONS","mimeType","LABEL_OPTIONS","ABOVE_AVERAGE","AVERAGE","BELOW_AVERAGE","NO_LABEL","STATES","HOME","RECORDING","REVIEWING","LABELING","ErgingClassifierPage","useState","mediaStream","setMediaStream","mediaRecorder","setMediaRecorder","displayState","setDisplayState","db","setDB","recordedVideos","setRecordedVideos","currentVideoIndex","setCurrentVideoIndex","currentVidSrc","setCurrentVidSrc","timer","setTimer","fileRef","useRef","fileState","setFileState","videoRef","label","isNext","a","id","transaction","clips","update","console","log","catch","err","error","newIndex","length","window","URL","revokeObjectURL","get","videoRecord","url","createObjectURL","data","useEffect","navigator","mediaDevices","getUserMedia","stream","getTracks","forEach","track","stop","enableStream","handleDataAvailable","event","size","blob","Blob","type","add","recorder","MediaRecorder","ondataavailable","initializeRecorder","database","Dexie","version","stores","open","stack","toCollection","count","zip","JSZip","sortedVideos","sort","record","filename","Date","now","toString","file","generateAsync","content","FileSaver","saveAs","clear","shuffle","array","temporaryValue","randomIndex","currentIndex","Math","floor","random","primaryKeys","videos","title","keywords-","className","ref","onSubmit","target","uploadFile","files","preventDefault","name","accept","required","multiple","styles","verticalLayout","vidSrc","onNextVideo","onPrevVideo","onReadyToLabel","currentClipNum","totalClips","labelOptions","onLabelSubmitted","onClick","interval","start","setInterval","clearInterval","disabled"],"mappings":"sTAuEeA,I,+2BCzDf,IAAMC,EAAkB,CACtBC,OAAO,GAGHC,EAAoB,CACxBC,SAAU,2BAINC,EAAgB,CACpBC,cAAe,gBACfC,QAAS,UACTC,cAAe,gBACfC,SAAU,YAKCC,EAAS,CACpBC,KAAM,OACNC,UAAW,YACXC,UAAW,YACXC,SAAU,YA6VGC,UA1Vf,WAAiC,IAAD,EACQC,mBAAS,MAAxCC,EADuB,KACVC,EADU,OAEYF,mBAAS,MAA5CG,EAFuB,KAERC,EAFQ,OAGUJ,mBAASN,EAAOC,MAAjDU,EAHuB,KAGTC,EAHS,OAIVN,mBAAS,MAAtBO,EAJuB,KAInBC,EAJmB,OAKcR,mBAAS,MAA9CS,EALuB,KAKPC,EALO,OAMoBV,mBAAS,GAApDW,EANuB,KAMJC,EANI,OAOYZ,mBAAS,MAA5Ca,EAPuB,KAORC,EAPQ,OAQJd,mBAAS,MAA5Be,EARuB,KAQhBC,EARgB,KAUxBC,EAAUC,mBAVc,EAWIlB,mBAAS,MAApCmB,EAXuB,KAWZC,EAXY,KAaxBC,EAAWH,mBAba,4CAgO9B,WAAgCI,EAAOC,GAAvC,qBAAAC,EAAA,yDAEQC,EAAKhB,EAAeE,GAC1BJ,EAAGmB,YAAY,KAAMnB,EAAGoB,MAAxB,sBAA+B,sBAAAH,EAAA,sEACPjB,EAAGoB,MAAMC,OAAOH,EAAI,CACxCH,UAF2B,eAK3BO,QAAQC,IAAR,0BAAsCL,EAAtC,eAAuDH,GAL5B,4CAO5BS,OAAM,SAAAC,GAAG,OAAIH,QAAQI,MAAM,oDAE1BC,EAAWvB,GAEXY,GAAUZ,IAAsBF,EAAe0B,OAAS,EAd9D,uBAeI7B,EAAgBZ,EAAOC,MAf3B,0BAiBa4B,EACTW,GAAY,EAEZA,GAAY,EApBhB,cAuBEtB,EAAqBsB,GAEjBrB,GACFuB,OAAOC,IAAIC,gBAAgBzB,GA1B/B,UA8B4BN,EAAGoB,MAAMY,IAAI9B,EAAeyB,IA9BxD,QA8BQM,EA9BR,OA+BQC,EAAMJ,IAAIK,gBAAgBF,EAAYG,MAC5C7B,EAAiB2B,GAhCnB,6CAhO8B,kEAmQ9B,8BAAAjB,EAAA,6DACEZ,EAAqBD,EAAoB,GAErCE,GACFuB,OAAOC,IAAIC,gBAAgBzB,GAJ/B,SAQ4BN,EAAGoB,MAAMY,IAAI9B,EAAeE,EAAoB,IAR5E,OAQQ6B,EARR,OASQC,EAAMJ,IAAIK,gBAAgBF,EAAYG,MAC5C7B,EAAiB2B,GAVnB,4CAnQ8B,kEAgR9B,8BAAAjB,EAAA,6DACEZ,EAAqBD,EAAoB,GAErCE,GACFuB,OAAOC,IAAIC,gBAAgBzB,GAJ/B,SAQ4BN,EAAGoB,MAAMY,IAAI9B,EAAeE,EAAoB,IAR5E,OAQQ6B,EARR,OASQC,EAAMJ,IAAIK,gBAAgBF,EAAYG,MAC5C7B,EAAiB2B,GAVnB,4CAhR8B,sBA+S9B,OA/RAG,qBAAU,WAAM,4CACd,4BAAApB,EAAA,+EAEyBqB,UAAUC,aAAaC,aAAa9D,GAF7D,OAEU+D,EAFV,OAGI9C,EAAe8C,GAHnB,gDAKInB,QAAQI,MAAR,MALJ,0DADc,sBAUd,GAAKhC,EAGH,OAAO,WACLA,EAAYgD,YAAYC,SAAQ,SAAAC,GAC9BA,EAAMC,YAfG,WAAD,wBAWZC,KAQD,CAACpD,IAGJ2C,qBAAU,WAWR,SAASU,EAAoBC,GAC3B,GAAIA,EAAMZ,KAAKa,KAAO,GAAKjD,EAAI,CAC7B,IAAIkD,EAAO,IAAIC,KAAK,CAACH,EAAMZ,MAAO,CAAEgB,KAAM,cAE1CpD,EAAGmB,YAAY,KAAMnB,EAAGoB,MAAxB,sBAA+B,4BAAAH,EAAA,sEACZjB,EAAGoB,MAAMiC,IAAI,CAC5BjB,KAAMc,IAFqB,OACvBhC,EADuB,OAI7BI,QAAQC,IAAR,wBAAoCL,EAApC,oBAJ6B,4CAK5BM,OAAM,SAAAC,GAAG,OAAIH,QAAQI,MAAM,kDAI9BhC,IAAgBE,GAvBpB,WACE,IACE,IAAM0D,EAAW,IAAIC,cAAc7D,EAAad,GAChD0E,EAASE,gBAAkBT,EAC3BlD,EAAiByD,GACjB,MAAM7B,GACNH,QAAQI,MAAMD,IAkBhBgC,MAKJpB,qBAAU,WACR,IACQqB,EAQH1D,KARG0D,EAAW,IAAIC,IAAM,iBAClBC,QAAQ,GAAGC,OAAO,CAAEzC,MAAO,gBACpCsC,EAASI,OAAOtC,OAAM,SAACC,GACrBH,QAAQI,MAAMD,EAAIsC,OAAStC,MAE7BxB,EAAMyD,OASVrB,qBAAU,WAAM,4CACd,8CAAApB,EAAA,yDACMnB,IAAiBX,EAAOI,SAD9B,sBAEQW,EAAe0B,OAAS,GAFhC,gCAGgC5B,EAAGoB,MAAMY,IAAI9B,EAAeE,IAH5D,OAGY6B,EAHZ,OAIMX,QAAQC,IAAIU,GACNC,EAAMJ,IAAIK,gBAAgBF,EAAYG,MAC5C7B,EAAiB2B,GANvB,kCAUapC,IAAiBX,EAAOC,OAAQc,EAV7C,kCAa6BF,EAAGoB,MAAM4C,eAAeC,QAbrD,oBAcqB,GAdrB,iBAeYC,EAAM,IAAIC,IACVC,EAAelE,EAAemE,OAhB1C,IAiBuBD,GAjBvB,gDAiBiBlD,EAjBjB,kBAkB6BlB,EAAGoB,MAAMY,IAAId,GAlB1C,QAkBcoD,EAlBd,OAmBYC,EAAW,GACM,aAAjBD,EAAOvD,QACTwD,EAAcD,EAAOvD,MAAb,KAEVwD,GAAyBC,KAAKC,MAAMC,WAAjB,OACnBR,EAAIS,KAAKJ,EAAUD,EAAOlC,MAxBlC,iDA0B4B8B,EAAIU,cAAc,CAAExB,KAAM,SA1BtD,QA0BYyB,EA1BZ,OA2BMC,IAAUC,OAAOF,EAAS,4BAG1B7E,EAAGoB,MAAM4D,QACT7E,EAAkB,MA/BxB,QAiCIE,EAAqB,GACrBE,EAAiB,MAlCrB,6CADc,uBAAC,WAAD,wBAuCdc,KACC,CAACvB,EAAcE,IAElBqC,qBAAU,WACR,SAAS4C,EAAQC,GAIf,IAHA,IAAiCC,EAAgBC,EAA7CC,EAAeH,EAAMtD,OAGlB,IAAMyD,GAGXD,EAAcE,KAAKC,MAAMD,KAAKE,SAAWH,GAIzCF,EAAiBD,EAHjBG,GAAgB,GAIhBH,EAAMG,GAAgBH,EAAME,GAC5BF,EAAME,GAAeD,EAGvB,OAAOD,EAjBK,4CAoBd,wCAAAjE,EAAA,yDACMnB,IAAiBX,EAAOG,UAD9B,iBAIIU,EAAGoB,MAAM4D,QAJb,IAMuBpE,GANvB,+CAMe+D,EANf,QAOUzB,EAAO,IAAIC,KAAK,CAACwB,GAAO,CAAEvB,KAAM,cAP1C,SAS2BpD,EAAGmB,YAAY,KAAMnB,EAAGoB,MAAxB,sBAA+B,4BAAAH,EAAA,sEACjCjB,EAAGoB,MAAMiC,IAAI,CAC5BjB,KAAMc,IAF0C,OAC5ChC,EAD4C,OAIlDI,QAAQC,IAAR,wBAAoCL,EAApC,oBAJkD,4CAT1D,6DAkBuBlB,EAAGoB,MAAM4C,eAAeyB,cAlB/C,WAmBIC,EAAST,EADLS,EAlBR,QAoBIvF,EAAkBuF,GAClBpE,QAAQC,IAAI,SAAUmE,GAElBpF,GACFuB,OAAOC,IAAIC,gBAAgBzB,KAEzBoF,EAAO9D,OAAS,GA1BxB,kCA2BgC5B,EAAGoB,MAAMY,IAAI0D,EAAOtF,IA3BpD,QA2BY6B,EA3BZ,OA4BMX,QAAQC,IAAIU,GACNC,EAAMJ,IAAIK,gBAAgBF,EAAYG,MAC5C7B,EAAiB2B,GA9BvB,6CApBc,0DAuEdb,KACC,CAACvB,EAAcE,IAqGlBqC,qBAAU,WACRf,QAAQC,IAAIX,KACX,CAACA,IAGF,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAK+E,MAAM,oBAAoBC,YAAW,CAAC,SAAU,cAAe,WACpE,0BAAMC,UAAU,SAASC,IAAKpF,EAASqF,SAZ3C,SAAsB/C,GACpBnC,EAAamC,EAAMgD,OAAOC,WAAWC,OACrClD,EAAMmD,mBAWF,2BAAO/C,KAAK,OAAOgD,KAAK,aAAaC,OAAO,OAAOC,UAAQ,EAACC,UAAQ,IACpE,6BAAK,6BACL,2BAAOnD,KAAK,YAEd,yBAAKyC,UAAWW,IAAOC,gBACrB,kBAAC,IAAD,CAAc/G,YAAaA,EAAagH,OAAQpG,EAAeR,aAAcA,EAAcgB,SAAUA,IACnGhB,IAAiBX,EAAOG,UACtB,kBAAC,IAAD,CACEqH,YA3TkB,2CA4TlBC,YA5TkB,2CA6TlBC,eAhCZ,WACMvG,GACFuB,OAAOC,IAAIC,gBAAgBzB,GAE7BC,EAAiB,MACjBF,EAAqB,GACrBN,EAAgBZ,EAAOI,WA2BbuH,eAAgB1G,EAAoBA,EAAoB,EAAI,EAC5D2G,WAAY7G,EAAiBA,EAAe0B,OAAS,IAGrD9B,IAAiBX,EAAOI,SAOxB,kBAAC,IAAD,CACIyH,aAAclI,EACdmI,iBA3Uc,8CA4UdH,eAAgB1G,EAAoBA,EAAoB,EAAI,EAC5D2G,WAAY7G,EAAiBA,EAAe0B,OAAS,IAGvD,4BAAQsF,QAxItB,WAgBA,IACQC,EAhBFvH,IACEE,IAAiBX,EAAOC,MAC1BW,EAAgBZ,EAAOE,WACvBO,EAAcwH,QAaZD,EAAWE,aAAY,WAC3BzH,EAAciD,OACdjD,EAAcwH,UApOA,KAsOhB3G,EAAS0G,IAdIrH,IAAiBX,EAAOE,YACjCO,EAAciD,OACdyE,cAAc9G,GACdC,EAAS,MACTV,EAAgBZ,EAAOG,cA6HmBiI,UAAW3H,GAC1CE,IAAiBX,EAAOE,UAAY,iBAAmB","file":"component---src-pages-hidden-erging-classifier-upload-js-f9524b431ae09672f44c.js","sourcesContent":["import React, { useState } from \"react\"\n\nimport styles from '../css/erging-classifier/label-display.module.css'\n\nfunction SeekDisplay({ onLabelSubmitted, currentClipNum, totalClips, videoRef }) {\n  const [beginning, setBeginning] = useState(0);\n  const [end, setEnd] = useState(0);\n  const [flipped, setFlipped] = useState(false);\n  const [nolabel, setNolabel] = useState(false);\n\n  function nextLabel() {\n    const beg = beginning.toString() + \"#beg\";\n    const ending = end.toString() + \"#end\";\n    const labelString = nolabel ? \"NO_LABEL\" : (\n      flipped ? ending + \"#\" + beg : beg + \"#\" + ending\n    );\n\n    onLabelSubmitted(labelString, true);\n  }\n\n  function setBeg(e) {\n    e.preventDefault();\n    if (videoRef.current && videoRef.current.currentTime) {\n      setBeginning(videoRef.current.currentTime);\n    }\n  }\n\n  function setEnding(e) {\n    e.preventDefault();\n    if (videoRef.current && videoRef.current.currentTime) {\n      setEnd(videoRef.current.currentTime);\n    }\n  }\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.leftContainer}>\n        <form className={styles.form}>\n          <div>\n            <button \n              onClick={setBeg} id=\"beg\">Beginning</button>\n            <label className={styles.label} htmlFor=\"beg\">{beginning}</label>\n          </div>\n          <div>\n            <button onClick={setEnding} id=\"end\">End</button>\n            <label className={styles.label} htmlFor=\"end\">{end}</label>\n          </div>\n          <div>\n            <input type=\"checkbox\" id=\"flipped\" onClick={event => setFlipped(event.target.checked)}/>\n            <label className={styles.label} htmlFor=\"flipped\">Flipped beginning and end?</label>\n          </div>\n          <div>\n            <input type=\"checkbox\" id=\"NO_LABEL\" onClick={event => setNolabel(event.target.checked)}/>\n            <label className={styles.label} htmlFor=\"NO_LABEL\">No Label</label>\n          </div>\n        </form>\n      </div>\n      <div className={styles.rightContainer}>\n        <div>\n          Video Clip {currentClipNum} / {totalClips}\n        </div>\n        <div className={styles.container}>\n          <button onClick={nextLabel}>\n            Submit label\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default SeekDisplay;","import React, { useState, useEffect, useRef } from 'react'\nimport Dexie from 'dexie'\nimport JSZip from 'jszip'\nimport FileSaver from 'file-saver'\n\nimport Layout from '../../components/general/layout'\nimport SEO from '../../components/general/seo'\nimport VideoDisplay from '../../components/erging-classifier/video-display'\nimport SeekDisplay from '../../components/erging-classifier/seek-display'\nimport LabelDisplay from '../../components/erging-classifier/label-display'\nimport ReviewDisplay from '../../components/erging-classifier/review-display'\n// import ErgingClassifierInfoDisplay from '../../components/erging-classifier/info-display'\nimport styles from '../../components/css/erging-classifier/erging-classifier.module.css'\n\nconst CAPTURE_OPTIONS = {\n  video: true,\n};\n\nconst RECORDING_OPTIONS = {\n  mimeType: \"video/webm; codecs=h264\",\n};\n\n// TODO: retrieve labels from remote server\nconst LABEL_OPTIONS = {\n  ABOVE_AVERAGE: 'Above Average',\n  AVERAGE: 'Average',\n  BELOW_AVERAGE: 'Below Average',\n  NO_LABEL: 'No Label',\n}\n\nconst CLIP_LENGTH = 9000;\n\nexport const STATES = {\n  HOME: 'home',\n  RECORDING: 'recording',\n  REVIEWING: 'reviewing',\n  LABELING: 'labeling',\n};\n\nfunction ErgingClassifierPage() {\n  const [mediaStream, setMediaStream] = useState(null);\n  const [mediaRecorder, setMediaRecorder] = useState(null);\n  const [displayState, setDisplayState] = useState(STATES.HOME);\n  const [db, setDB] = useState(null);\n  const [recordedVideos, setRecordedVideos] = useState(null);\n  const [currentVideoIndex, setCurrentVideoIndex] = useState(0);\n  const [currentVidSrc, setCurrentVidSrc] = useState(null);\n  const [timer, setTimer] = useState(null);\n\n  const fileRef = useRef();\n  const [fileState, setFileState] = useState(null);\n\n  const videoRef = useRef();\n\n  // video display\n  useEffect(() => {\n    async function enableStream() {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia(CAPTURE_OPTIONS);\n        setMediaStream(stream);\n      } catch(err) {\n        console.error(err);\n      }\n    }\n\n    if (!mediaStream) {\n      enableStream();\n    } else {\n      return function cleanup() {\n        mediaStream.getTracks().forEach(track => {\n          track.stop();\n        });\n      }\n    }\n  }, [mediaStream]);\n\n  // recording video\n  useEffect(() => {\n    function initializeRecorder() {\n      try {\n        const recorder = new MediaRecorder(mediaStream, RECORDING_OPTIONS);\n        recorder.ondataavailable = handleDataAvailable;\n        setMediaRecorder(recorder);\n      } catch(err) {\n        console.error(err);\n      }\n    }\n\n    function handleDataAvailable(event) {\n      if (event.data.size > 0 && db) {\n        var blob = new Blob([event.data], { type: \"video/mp4\" });\n        // save to the database\n        db.transaction('rw', db.clips, async () => {\n          const id = await db.clips.add({\n            data: blob,\n          });\n          console.log(`Wrote new video clip ${id} to the database`);\n        }).catch(err => console.error(\"Could not write new video clip to database\"));\n      }\n    }\n\n    if (mediaStream && !mediaRecorder) {\n      initializeRecorder();\n    }\n  });\n\n  // local database for video clips\n  useEffect(() => {\n    function initializeDB() {\n      const database = new Dexie(\"ClipDatabase\");\n      database.version(1).stores({ clips: \"++id,*label\" });\n      database.open().catch((err) => {\n        console.error(err.stack || err);\n      })\n      setDB(database);\n    }\n\n    if (!db) {\n      initializeDB();\n    }\n  });\n\n  // listen to page state change\n  useEffect(() => {\n    async function update() {\n      if (displayState === STATES.LABELING) {\n        if (recordedVideos.length > 0) {\n          const videoRecord = await db.clips.get(recordedVideos[currentVideoIndex]);\n          console.log(videoRecord);\n          const url = URL.createObjectURL(videoRecord.data);\n          setCurrentVidSrc(url);\n        }\n\n        // eventually: retrieve the label_options data from the server\n      } else if (displayState === STATES.HOME && recordedVideos) {\n        // if the database isn't empty, download all the files in the database\n        // with filename label-id.webm (eventually: send the data to a server)\n        const numRecords = await db.clips.toCollection().count();\n        if (numRecords > 0) {\n          const zip = new JSZip();\n          const sortedVideos = recordedVideos.sort();\n          for (const id of sortedVideos) {\n            const record = await db.clips.get(id);\n            let filename = \"\";\n            if (record.label !== 'NO_LABEL') {\n              filename = `${record.label}-`;\n            }\n            filename = filename + `${Date.now().toString()}.mp4`;\n            zip.file(filename, record.data);\n          }\n          const content = await zip.generateAsync({ type: \"blob\" });\n          FileSaver.saveAs(content, \"captured-rowing-data.zip\");\n          \n          // clear the database\n          db.clips.clear();\n          setRecordedVideos(null);\n        }\n        setCurrentVideoIndex(0);\n        setCurrentVidSrc(null);\n      }\n    }\n\n    update();\n  }, [displayState, db])\n\n  useEffect(() => {\n    function shuffle(array) {\n      var currentIndex = array.length, temporaryValue, randomIndex;\n    \n      // While there remain elements to shuffle...\n      while (0 !== currentIndex) {\n    \n        // Pick a remaining element...\n        randomIndex = Math.floor(Math.random() * currentIndex);\n        currentIndex -= 1;\n    \n        // And swap it with the current element.\n        temporaryValue = array[currentIndex];\n        array[currentIndex] = array[randomIndex];\n        array[randomIndex] = temporaryValue;\n      }\n    \n      return array;\n    }\n\n    async function update() {\n      if (displayState === STATES.REVIEWING) {\n        // TEMP\n        // load mp4s into db\n        db.clips.clear();\n\n        for (const file of fileState) {\n          var blob = new Blob([file], { type: \"video/mp4\" });\n          // save to the database\n          const result = await db.transaction('rw', db.clips, async () => {\n            const id = await db.clips.add({\n              data: blob,\n            });\n            console.log(`Wrote new video clip ${id} to the database`);\n          })//.catch(err => console.error(\"Could not write new video clip to database\"));\n        }\n\n        // initialize the new set of clips to iterate over for labeling\n        let videos = await db.clips.toCollection().primaryKeys();\n        videos = shuffle(videos);\n        setRecordedVideos(videos);\n        console.log(\"videos\", videos);\n\n        if (currentVidSrc) {\n          window.URL.revokeObjectURL(currentVidSrc);\n        }\n        if (videos.length > 0) {\n          const videoRecord = await db.clips.get(videos[currentVideoIndex]);\n          console.log(videoRecord);\n          const url = URL.createObjectURL(videoRecord.data);\n          setCurrentVidSrc(url);\n        }\n\n        /* initialize the new set of clips to iterate over for labeling\n        let videos = await db.clips.toCollection().primaryKeys();\n        videos = shuffle(videos);\n        setRecordedVideos(videos);\n        console.log(videos);\n\n        if (currentVidSrc) {\n          window.URL.revokeObjectURL(currentVidSrc);\n        }\n        if (videos.length > 0) {\n          const videoRecord = await db.clips.get(videos[currentVideoIndex]);\n          console.log(videoRecord);\n          const url = URL.createObjectURL(videoRecord.data);\n          setCurrentVidSrc(url);\n        }*/\n      }\n    }\n\n    update();\n  }, [displayState, db])\n\n  function toggleRecording() {\n    if (mediaRecorder) {\n      if (displayState === STATES.HOME) {\n        setDisplayState(STATES.RECORDING);\n        mediaRecorder.start();\n        initializeTimer();\n        // TODO: clean up current processes (if necessary)\n      } else if (displayState === STATES.RECORDING) {\n        mediaRecorder.stop();\n        clearInterval(timer);\n        setTimer(null);\n        setDisplayState(STATES.REVIEWING);\n      }\n    }\n  }\n\n  function initializeTimer() {\n    const interval = setInterval(() => {\n      mediaRecorder.stop();\n      mediaRecorder.start();\n    }, CLIP_LENGTH);\n    setTimer(interval);\n  }\n\n  async function onLabelSubmitted(label, isNext) {\n    // label the current video, move to the next one\n    const id = recordedVideos[currentVideoIndex];\n    db.transaction('rw', db.clips, async () => {\n      const updated = await db.clips.update(id, {\n        label\n      });\n      if (updated) {\n        console.log(`Labeled new video clip ${id} with label ${label}`);\n      }\n    }).catch(err => console.error(\"Error: Could not label the current video clip\"));\n    \n    let newIndex = currentVideoIndex;\n\n    if (isNext && currentVideoIndex === recordedVideos.length - 1) {\n      setDisplayState(STATES.HOME);\n      return;\n    } else if (isNext) {\n      newIndex += 1;\n    } else {\n      newIndex -= 1;\n    }\n\n    setCurrentVideoIndex(newIndex);\n\n    if (currentVidSrc) {\n      window.URL.revokeObjectURL(currentVidSrc);\n    }\n\n    // set video source\n    const videoRecord = await db.clips.get(recordedVideos[newIndex]);\n    const url = URL.createObjectURL(videoRecord.data);\n    setCurrentVidSrc(url);\n  }\n\n  async function onNextVideo() {\n    setCurrentVideoIndex(currentVideoIndex + 1);\n\n    if (currentVidSrc) {\n      window.URL.revokeObjectURL(currentVidSrc);\n    }\n\n    // set video source\n    const videoRecord = await db.clips.get(recordedVideos[currentVideoIndex + 1]);\n    const url = URL.createObjectURL(videoRecord.data);\n    setCurrentVidSrc(url);\n  }\n\n  async function onPrevVideo() {\n    setCurrentVideoIndex(currentVideoIndex - 1);\n\n    if (currentVidSrc) {\n      window.URL.revokeObjectURL(currentVidSrc);\n    }\n\n    // set video source\n    const videoRecord = await db.clips.get(recordedVideos[currentVideoIndex - 1]);\n    const url = URL.createObjectURL(videoRecord.data);\n    setCurrentVidSrc(url);\n  }\n\n  function onReadyToLabel() {\n    if (currentVidSrc) {\n      window.URL.revokeObjectURL(currentVidSrc);\n    }\n    setCurrentVidSrc(null);\n    setCurrentVideoIndex(0);\n    setDisplayState(STATES.LABELING);\n  }\n\n  function onFormSubmit(event) {\n    setFileState(event.target.uploadFile.files);\n    event.preventDefault();\n  }\n\n  useEffect(() => {\n    console.log(fileState)\n  }, [fileState]);\n\n  return (\n    <Layout>\n      <SEO title=\"Erging Classifier\" keywords-={['gatsby', 'application', 'react']}/>\n      <form className=\"upload\" ref={fileRef} onSubmit={onFormSubmit}>\n        <input type=\"file\" name=\"uploadFile\" accept=\".mp4\" required multiple />\n        <br/><br/>\n        <input type=\"submit\" />\n      </form>\n      <div className={styles.verticalLayout}>\n        <VideoDisplay mediaStream={mediaStream} vidSrc={currentVidSrc} displayState={displayState} videoRef={videoRef} />\n        { displayState === STATES.REVIEWING ?\n            <ReviewDisplay\n              onNextVideo={onNextVideo}\n              onPrevVideo={onPrevVideo}\n              onReadyToLabel={onReadyToLabel}\n              currentClipNum={currentVideoIndex ? currentVideoIndex + 1 : 1}\n              totalClips={recordedVideos ? recordedVideos.length : 0}\n            />\n          :\n            ( displayState === STATES.LABELING ?\n              /*<SeekDisplay\n                onLabelSubmitted={onLabelSubmitted}\n                currentClipNum={currentVideoIndex ? currentVideoIndex + 1 : 1}\n                totalClips={recordedVideos ? recordedVideos.length : 0}\n                videoRef={videoRef}\n              />*/\n              <LabelDisplay\n                  labelOptions={LABEL_OPTIONS}\n                  onLabelSubmitted={onLabelSubmitted}\n                  currentClipNum={currentVideoIndex ? currentVideoIndex + 1 : 1}\n                  totalClips={recordedVideos ? recordedVideos.length : 0}\n                />\n              :\n                <button onClick={toggleRecording} disabled={!mediaRecorder}>\n                  {displayState === STATES.RECORDING ? 'STOP RECORDING' : 'START RECORDING'}\n                </button>\n            )\n        }\n      </div>\n    </Layout>\n  );\n}\n\nexport default ErgingClassifierPage;\n"],"sourceRoot":""}